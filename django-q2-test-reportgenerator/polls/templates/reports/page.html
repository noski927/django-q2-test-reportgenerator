<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <title>Отчёты</title>

    {% if report and report.status != "DONE" and report.status != "FAILED" %}
    <!-- Авто-обновление пока отчёт генерируется -->
    <meta http-equiv="refresh" content="2">
    {% endif %}
</head>

<body>
    <h1>Генерация отчёта</h1>

    <form method="post" action="{% url 'report_page' %}">
        {% csrf_token %}
        <button type="submit">Сгенерировать отчёт</button>
    </form>

    <hr />

    {% if report %}
    <p><b>ID отчёта:</b> {{ report.id }}</p>
    <p><b>Статус:</b> {{ report.get_status_display }}</p>

    {% if report.status == "DONE" %}
    <h2>Результат</h2>
    <div>
        {{ report.html|safe }}
    </div>

    {% elif report.status == "FAILED" %}
    <h2>Ошибка</h2>
    <pre>{{ report.error }}</pre>

    {% else %}
    <p>Отчёт генерируется… страница обновится автоматически.</p>
    {% endif %}
    {% else %}
    <p>Нажмите кнопку, чтобы создать отчёт.</p>
    {% endif %}
</body>

</html>